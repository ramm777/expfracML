clear all
close all

addpath('F:\mrst-2017a\modules\vemmech\expfrac\utils');
addpath('F:\mrst-2017a\modules\vemmech\expfrac\modelFunctions');
addpath('F:\mrst-2017a\modules\vemmech\expfrac\Solvers');
addpath('F:\mrst-2017a\modules\vemmech\expfrac\createGrid');

% Select manually: 
n_runs = 320;
downsize  = 1;                        % in reality 10 as data already was coarsened
delta     = 9e-03;                    % 9e-04;   
stepThin  =    2.25533628674990e-06;  % No depth, thin sample

gapr = sqrt((0.000001*milli*darcy)*12);  % Residual gap based on parallel plate and matrix perm. Is removed from mech apertures. 
datapath = 'F:\mrst-2017a\modules\vemmech\expfrac\ML\NoDepthThinThick2000'; 
ss = get(groot, 'Screensize');

% 2000 test images, No depth
is = [1262,1887,1515,802,1583,1383,1599,1138,1178,118,577,1152,112,1234,925,1614,1794,1572,557,298,1526,206,1311,1521,1690,779,1676,1193,722,980,32,1648,21,837,1820,316,1994,1659,1200,16,1927,611,1405,1068,1517,1386,784,1525,112,1066,614,538,788,960,475,706,978,1060,1390,487,1377,1143,483,810,71,844,1243,1042,1772,26,1555,976,251,1827,1338,448,1811,49,1088,730,1976,1954,1919,1429,764,1488,220,726,427,1113,1075,1365,1396,1496,1666,1971,1233,1387,1767,842,197,973,1496,269,626,353,415,806,1340,1524,263,1123,1548,453,361,263,83,4,716,301,956,1426,920,615,1707,331,210,527,532,124,728,1856,1236,1269,177,461,439,966,638,1178,1380,954,1285,997,1342,342,631,893,383,445,76,343,145,416,889,547,745,1224,1665,171,1836,819,1947,256,1302,1169,1119,898,1426,352,771,1066,1732,1999,1333,1567,964,825,634,519,301,1522,1705,460,316,157,1578,688,807,211,152,1763,1049,1924,935,606,1154,904,63,1824,1479,971,562,1797,639,13,965,1217,739,1579,1905,416,518,324,1079,1064,458,1891,1133,812,1207,782,1607,912,388,55,996,137,220,12,1439,842,1487,1071,1178,1492,506,1935,1843,896,687,1895,117,1284,147,1408,1874,779,813,1918,1710,1261,187,449,688,580,36,877,179,547,875,1039,966,176,1366,681,565,1264,71,1269,19,1240,587,871,271,706,1076,1300,1204,833,1013,538,1066,424,113,1243,385,1110,876,755,520,792,1997,1905,1152,878,917,859,1849,1878,904,1150,653,1062,1985,1510,568,1751,1170,1453,1772,269,1084,1808,1396,79,999,1375,1425,60,646,889,1734,1262,229,1389,1795,1870,182,1620,510,826,209,104,186,1312,526,1226,893,98,1052,444,736,667,900,859,1781,1376,453,1640,858,1666,1383,940,1577,1457,394,1607,665,1387,1474,1049,1232,1324,924,526,1989,251,1729,417,410,1992,1269,79,413,284,922,1679,219,948,1532,545,1653,1696,711,1939,1593,480,540,173,1535,545,24,909,106,1301,998,379,999,1400,1250,93,644,1995,1916,506,742,1909,233,719,334,729,1472,1091,617,269,1014,1322,171,1151,753,1518,1328,1840,1353,151,181,405,1,1091,226,358,1764,490,339,1272,1382,969,1627,1027,1688,300,541,984,845,1523,1387,1915,1007,1777,876,1961,1030,177,918,1764,1439,589,753,1367,1179,94,227,1146,1747,114,1286,645,1948,1188,1045,1527,435,1870,1623,1089,1849,538,1466,1573,1612,180,1306,1366,1766,1582,471,417,804,110,994,1598,1253,736,904,830,716,1423,95,1335,519,412,1979,1019,261,305,750,920,1758,1395,128,1811,268,1169,1066,1540,57,362,743,900,1059,1345,1640,1567,832,905,393,82,552,1172,1418,1200,1706,658,590,1246,1806,1336,1027,1820,520,180,15,1928,1955,963,388,633,1828,39,337,788,568,1659,242,1980,1901,1979,1985,1631,1263,1317,1127,1963,110,504,1455,1284,1293,367,1981,120,1643,1756,441,784,587,517,781,1154,1280,1366,1655,1196,1352,971,218,1876,863,1506,166,1347,435,1922,829,1215,1945,1585,115,158,1931,1818,1263,107,1875,597,1017,1106,1646,728,697,1845,85,1417,701,1435,195,1593,415,690,540,723,612,1362,409,1075,1249,80,1793,1953,1221,84,1498,1321,1367,1640,1131,419,124,701,1596,28,624,1964,630,1440,909,1092,191,1964,971,24,1612,363,20,1108,716,501,1897,1477,489,1665,1758,1727,467,479,942,1578,361,1035,1090,442,1090,1266,992,1902,189,1417,1277,1419,1806,1193,1542,1558,255,1796,1331,1911,359,1692,165,1861,1531,135,1071,194,433,312,978,246,502,1989,852,754,718,217,312,1010,399,692,48,1419,891,500,626,397,181,1132,1297,861,1537,603,1270,1325,1069,789,876,421,365,797,449,1269,1158,651,1184,220,148,1376,1749,944,1954,1174,524,1544,1188,890,116,1491,1474,347,631,763,169,1885,418,765,1281,801,1445,496,522,758,1616,1101,1563,1151,44,1470,1608,1506,1471,1919,830,633,958,44,1162,274,1388,1316,736,772,1045,1569,1194,872,502,1755,786,883,164,699,1465,930,1840,1579,320,1717,1225,499,727,804,425,1984,1492,1558,1142,205,1333,1058,1106,456,246,727,1572,998,1034,435,83,1127,322,1008,646,1587,445,1305,402,1144,693,764,387,181,1574,729,872,1988,1867,1334,1435,594,1133,1820,1966,985,1719,624,243,649,258,1251,653,1433,336,956,131,1947,270,954,1472,1796,1510,100,708,86,1121,1176,1062,429,1620,1170,1351,1748,1744,1475,631,1193,874,834,296,108,1907,103,1293,1849,504,1109,1446,1584,872,1190,1757,1016,260,407,202,1208,1686,1054,1760,110,1169,1193,1350,1578,1332,1949,509,1861,1728,114,426,77,1693,1116,644,1333,1811,468,845,245,868,1186,1797,677,1550,1418,1595,958,622,1646,737,1558,1147,1076,1140,1838,1933,1698,329,1986,1672,277,1295,128,422,1752,1416,245,446,1660,1247,378,1741,1760,1716,176,822,1678,1628,852,928,1066,409,1339,938,1990,372,143,571,1459,446,983,1850,1867,1274,1481,208,1916,1768,841,1150,862,1431,613,1575,1971,1316,1903,221,100,77,1577,771,1703,315,709,322,1901,406,1925,1380,1502,1777,1517,964,529,795,1088,1183,1227,352,620,1265,1918,881,157,1842,710,1191,1026,927,397,1126,1251,1680,36,1379,603,436,1854,1048,648,1423,1852,1117,291,1016,501,427,544,1105,1419,1865,1192,1008,1197,647,1496,1136,1357,656,1792,945,1836,1507,1584,753,769,614,590,618,323,712,1714,321,436,621,210,1388,1543,1016,482,1461,1104,1750,1551,1599,243,1092,1605,228,1393,1802,1063,1766,997,1129,163,1245,1255,1582,175,1197,912,1660,1841,436,1303,296,815,1128,1607,609,678,833,762,593,1560,635,153,521,1244,286,501,1081,544,1867,422,1077,591,866,241,115,873,1992,607,361,832,717,295,660,952,1002,1062,1360,709,361,1817,1432,249,26,1403,1077,988,497,1447,1206,1363,1247,380,37,1919,1883,523,1259,1781,468,276,1179,661,758,1920,836,1563,1151,394,1004,338,34,715,1162,331,433,1335,861,1255,134,1726,1279,17,165,1912,1528,571,1638,1696,1812,1005,1822,934,405,1140,139,1387,398,711,1830,1835,319,1070,1871,353,1548,132,752,219,1197,184,1511,1171,1670,470,547,1937,240,629,1168,1444,1481,1572,1442,571,82,451,159,1798,1452,39,89,1090,1484,1184,1160,729,1630,1525,77,651,733,1002,1085,1212,1322,85,1470,1872,1680,106,1583,1702,745,1863,362,1760,1633,1973,920,767,691,1058,1890,1841,1544,1597,1116,1334,1081,457,1923,607,281,1409,351,1429,527,1411,1798,1805,95,1643,603,1802,249,27,236,1236,1398,27,1471,1376,1336,548,1443,802,1140,1325,1473,1826,1045,1418,1429,1995,1782,1415,831,846,588,654,1546,1138,1770,110,1347,833,1300,811,1044,797,401,862,1657,751,944,1072,1078,1266,642,719,1800,3,770,1788,1861,1815,1437,1227,1084,842,576,287,863,1443,1484,1714,1687,329,600,1446,1791,1882,229,77,675,1434,1976,1908,978,52,349,1682,1078,851,742,1127,1153,493,1053,214,1284,1775,1144,373,1155,1546,1592,1617,1335,1733,1073,1730,415,193,40,1989,253,1618,606,7,358,1707,1976,487,210,1296,1362,1565,879,176,280,186,1943,1908,1989,342,495,737,576,1747,239,502,1539,414,884,1892,1999,1582,1220,1744,416,1457,945,1932,1095,1990,570,536,124,972,838,1923,956,138,1028,687,426,617,226,1722,524,163,1843,893,458,279,1286,1145,1710,1998,1401,881,171,1762,1580,454,687,1475,1301,1952,1030,1703,948,167,737,1363,1808,1039,23,1774,1439,1619,1230,662,5,297,357,772,946,1060,1283,1495,1182,1004,414,839,553,1638,507,447,1203,904,1181,1213,1070,289,1780,580,44,323,576,614,1452,241,1139,502,462,88,1479,1771,147,1255,130,324,609,152,263,354,769,996,1514,701,1252,336,1483,698,946,1158,1571,1452,731,1207,34,419,304,1009,754,614,656,1602,1848,277,132,894,220,209,1476,435,1893,343,465,1474,567,1207,735,517,1447,1415,1261,1690,1726,179,1732,175,717,1126,450,405,1312,1753,1973,615,313,992,545,961,1975,534,420,515,1169,671,456,373,1124,1089,310,320,556,887,935,31,416,935,1177,806,1317,1760,757,701,1270,1840,185,1012,5,1173,1327,1307,841,351,1064,122,1652,624,592,1491,1669,1509,899,1543,1053,1101,531,1750,1041,202,176,71,775,1380,1109,478,177,1227,1500,375,1310,1097,1548,1625,1455,916,724,1271,1777,570,845,1197,317,313,10,461,171,1459,1601,532,1139,1348,159,1097,550,575,1480,1950,1468,1910,450,744,1975,1209,1692,177,1445,192,867,1434,1101,137,1424,577,1909,1588,1451,69,1785,1464,1157,718,404,27,876,1438,216,919,1141,690,243,374,1749,539,1757,244,1597,1396,621,1637,308,1263,1297,78,575,1399,1594,1479,413,1756,745,1228,177,872,1569,974,1286,434,1103,936,460,913,1673,663,362,456,1010,1552,954,639,257,157,1835,903,1058,181,111,1139,693,981,395,1042,1841,469,1405,1754,1660,668,1831,1172,1857,1106,1010,1705,1556,881,28,868,713,441,1736,1437,132,507,1460,1873,1784,1446,516,1722,942,1223,1545,111,274,1113,1516,750,1268,1801,1105,751,153,1642,768,57,342,1594,1927,1965,801,53,128,558,819,701,421,747,721,1669,305,1924,392,114,1001,1218,401,1251,288,576,1564,694,139,686,773,622,1205,1454,1417,1541,1128,72,187,31,1225,229,632,1102,1505,674,586,1989,277,814,150,1327,1314,894,1196,255,1796,95,1787,318,1421,702,1448,1089,301,246,994,401,1740,986,1227,1647,1442,1077,1302,1474,148,1349,1331,267,1593,921,1633,54,1440,297,1666,73,198,1971,401,1297,492,157,1104,1722,932,1696,1286,1704,385,199,1581,1090,368,1768,1686,21,800,240,1852,3,616,1022,263,1169,355,1613,382,143,852,1205,1675,964,13,631,1947,1275,1600,446,366,553,659,503,287,1171,1263,1494,808,382,1577,3,120,1523,359,1958,1510,1445,1991,556,136,634,1996,1144,474,213,39,385,621,227,1688,969,878,399,1583,44,1883,255,1102,65,1065,1239,1258,1648,821,974,1704,877,1374,17,195,1742,719,132,780,1713,28,770,1913,1744,1344,706,1398,1361,1775,1465,1913,166,347,1311,1368,1839,1521,70,1582,1269,4,1667,1600,10,1213,480]; 
iis = [831,1995,1625,1102,737,1879,1891,1363,1983,1500,1753,1247,757,1965,1619,1311,293,1562,1999,579,1899,1871,1058,562,1924,616,1898,1663,1718,527,1247,1596,800,1337,322,119,629,547,6,1067,107,1129,61,381,568,1898,580,804,105,1803,80,1422,984,1632,1795,985,459,1029,811,1713,251,1126,1898,306,1370,1780,1867,1306,1737,193,843,959,1236,663,1171,53,667,1960,1131,835,1196,27,1561,1197,798,1384,1061,271,1137,407,93,1905,1871,545,772,16,1623,1360,58,1902,1773,1825,1474,1221,1122,1594,1727,1950,1977,80,1965,843,438,184,1159,465,792,450,1314,1020,1889,496,1973,1283,792,482,54,1827,1163,1209,1227,1538,706,883,927,1262,1244,1860,1571,182,1046,1793,1247,1875,594,1857,521,993,1116,15,545,53,1019,5,1859,691,1822,1817,269,1383,1574,497,1583,7,1846,1809,1520,1601,329,526,697,289,1914,1611,257,661,1760,1849,117,183,1721,1533,857,864,1446,463,1497,483,1935,1853,1311,1468,1932,808,1782,787,1841,785,1832,264,459,1109,1819,1917,1555,1815,494,953,492,1791,323,1272,110,173,709,1625,286,198,1413,451,1476,1964,574,42,122,1490,1425,668,204,1670,1145,1874,1888,437,1754,1898,1571,1771,340,303,119,1148,158,1408,79,1168,1973,1206,660,16,457,1361,136,441,555,1126,824,1168,1950,263,249,1122,1020,1547,737,868,1828,1718,1228,297,831,1458,1938,1241,1989,1564,539,1372,399,881,1308,14,339,792,994,1403,1120,479,1093,1479,104,1970,967,666,1935,1026,227,746,122,119,392,308,1893,1939,27,1677,1150,1402,901,407,383,1935,1484,1255,346,1391,603,890,768,895,763,181,431,1290,165,1204,1021,364,111,934,1754,38,1537,1179,1820,1694,1991,1201,1708,205,1495,283,1157,881,370,1444,603,579,1906,612,1319,253,762,1007,634,182,415,1917,1817,1442,1323,1964,866,1036,1914,1860,1058,1626,155,1672,1086,610,980,1231,551,1937,840,1927,1684,226,328,1808,93,1588,966,1261,802,685,54,1201,1157,765,1233,1787,1999,687,737,1232,41,1055,1779,1808,1059,679,1871,445,384,6,91,1403,1977,44,1190,1811,862,1101,127,1342,1231,678,1906,186,1947,572,1412,1357,1633,323,987,568,824,818,1020,1842,1371,1734,330,981,1873,1250,1518,1097,519,735,1920,235,1761,689,1688,1723,1325,893,1439,571,131,1808,18,888,947,1738,1723,144,1852,910,713,1741,703,1631,410,1120,1104,1846,140,1408,701,122,1454,1103,263,1574,1926,1284,343,195,1865,1657,368,1043,899,1269,819,1030,1793,1897,1014,873,1035,1026,1258,880,1760,883,1681,16,1854,796,1573,1034,489,1639,701,919,1616,1062,1483,1782,1480,77,189,848,934,1630,156,1423,1722,846,468,315,1434,486,518,1464,1621,1560,1278,886,224,805,1516,1735,1983,1377,1782,1543,1986,1586,608,481,280,1764,888,892,840,807,1908,1057,1818,332,1648,621,1287,1170,1025,1102,1455,817,1239,165,1194,1852,788,1012,1296,211,1468,1183,1880,916,48,462,438,593,1526,1666,960,1132,139,1706,623,1939,527,77,1725,6,695,1345,257,978,1985,578,1046,944,1536,1691,11,639,582,549,1025,874,1738,848,856,1212,368,1511,912,27,984,441,1423,538,1900,1570,189,861,1682,950,1937,673,1065,200,572,1081,1745,1968,624,1498,684,99,59,395,76,205,571,1006,1449,720,1482,563,571,1363,736,400,1150,1385,1543,941,938,1053,593,654,368,107,526,1558,597,944,1430,829,1910,1374,6,1129,1054,385,1261,1605,1595,1828,449,142,1262,69,1452,1473,1536,1379,1565,661,1669,234,1397,311,779,532,1280,1880,1768,1640,615,1943,115,582,242,891,673,1655,29,1069,1718,630,1367,881,1041,598,174,1260,1805,1039,109,57,1480,499,591,1049,882,741,1436,922,208,1900,479,697,1620,1334,972,662,966,27,144,280,1891,645,1539,9,733,454,253,1058,748,76,199,675,1540,1654,1391,469,679,441,161,1764,1686,838,613,1511,1720,1357,1118,156,586,15,1940,385,92,1225,54,837,1557,762,764,172,1081,1193,947,1593,1626,1251,1330,1285,1825,1580,1053,1972,1739,440,1403,1396,1397,1631,607,1570,1382,1923,316,440,982,1147,2000,291,631,1859,1786,1800,1081,1939,325,1503,103,457,99,24,677,738,1295,1298,162,587,630,1263,1530,1320,492,538,1349,624,169,1017,1751,741,1357,1163,1527,281,698,320,1314,1135,357,950,324,534,1517,1516,80,622,910,51,399,1362,800,1471,384,732,605,341,1820,1291,663,797,1986,181,1925,734,1636,522,1298,320,1183,225,664,1971,461,1678,1445,1798,524,947,317,1865,869,1996,946,1504,873,1048,1876,461,799,1713,1123,1136,236,1488,300,1432,1329,567,150,951,1477,159,1729,1707,845,1458,927,339,1744,303,1593,1618,323,71,189,1354,1303,1320,94,981,1800,1741,1641,1947,143,1243,1663,1010,403,1021,188,160,1709,762,397,427,1518,992,327,691,261,986,1151,1197,767,761,222,785,1083,1013,1376,1210,825,967,1336,1713,201,1625,1210,1337,94,1788,197,1175,48,557,78,538,1289,247,607,1168,554,400,1118,544,1779,1131,174,671,219,1741,483,1617,115,791,1496,329,1868,1213,994,59,744,692,1057,1453,1224,1681,645,783,1556,904,90,978,616,245,1427,1193,1001,1127,340,479,744,1492,597,1456,1898,1735,1354,188,1984,310,275,1149,41,1280,894,538,1284,550,1511,843,1954,1198,12,1826,1131,945,1026,1113,1542,1712,1990,1831,376,1579,11,952,972,1450,707,1927,1727,1387,133,675,1328,162,1314,686,1164,1540,573,1899,1608,1151,1069,289,590,1378,1257,983,1345,1107,332,1893,975,1147,673,396,113,1647,81,1621,1882,1509,2000,1483,1098,556,1787,71,883,1790,577,1173,1270,592,473,456,1505,1580,400,1217,918,1488,676,1512,976,1018,478,128,1000,645,840,704,980,12,1643,1650,1725,1719,1720,1418,880,413,1669,152,1077,51,1302,307,1866,624,1818,920,1127,1073,137,869,290,496,131,1831,31,1621,373,1634,862,1703,1050,1209,567,1825,1035,1118,196,661,983,190,846,799,564,1198,1030,457,1250,942,992,1614,1530,961,321,496,1338,91,1713,1782,797,1561,5,1454,374,1730,799,1455,1113,221,1277,1011,1763,1362,90,325,1883,1521,960,1197,479,698,996,482,973,263,1203,1054,111,1333,536,1625,1269,1476,239,1569,1578,772,1927,244,1464,58,304,1226,1056,1673,1427,1162,918,1655,857,915,522,454,1043,1408,1897,1111,789,1634,423,1340,929,486,191,1757,88,836,556,1120,707,1020,397,471,1543,217,324,333,513,1725,1759,201,1515,1902,1377,515,1685,1417,1093,1196,251,98,240,836,600,778,1731,1998,1120,1146,579,1269,1589,1975,1079,1720,80,1155,1957,1286,1999,1057,1565,1073,1073,26,815,1097,706,196,380,402,1052,1105,1884,985,1352,606,802,833,1114,1039,987,970,1551,171,736,362,1804,392,1579,484,1021,1092,46,500,478,1770,858,1450,1321,1186,1540,240,847,100,1779,866,466,807,797,389,1750,25,1857,116,146,179,931,378,914,1907,841,353,1730,61,633,250,322,22,1916,1687,1750,870,498,1480,1997,1446,1493,1473,1481,992,933,966,1151,762,1569,926,1761,1290,1221,1097,389,1040,1894,247,376,828,100,1231,1951,178,886,578,411,392,562,1573,1293,320,1228,689,637,765,1660,718,1827,1126,1810,774,368,135,1694,639,1644,1186,1039,1132,606,1205,283,576,760,1120,838,155,729,1044,1225,375,555,641,1006,663,1558,1531,336,1574,1106,1420,43,579,925,104,1893,1720,1194,1868,1249,550,1631,1323,498,1914,181,1149,184,1238,1689,1841,1361,91,1923,1527,592,1213,433,1652,237,533,967,886,1539,1479,1042,434,613,1240,1080,1036,1265,495,409,336,1074,1858,813,932,218,1199,964,1065,1773,1622,1761,1089,453,805,487,669,757,1361,1158,341,1773,1908,696,911,1907,1708,1765,1726,177,1078,1148,1565,7,1912,1871,868,1760,405,1980,1869,1704,379,236,66,1565,635,1199,146,1487,584,483,504,1203,1401,1350,72,305,1325,1431,112,1336,763,1031,729,1442,1575,986,1386,999,1618,418,1478,489,302,702,1769,1722,1690,1543,1414,198,371,1202,78,1419,629,95,1107,1048,1736,1246,1676,1359,393,675,1020,1087,1512,1094,1107,479,61,89,1658,1008,511,1829,199,1964,986,945,136,396,1431,630,1455,1043,434,444,648,1726,253,408,1458,1856,1478,1863,611,1979,1386,1434,1414,935,904,703,63,1837,333,482,175,917,41,1903,1598,1549,1882,127,551,186,1313,1434,1667,1653,323,65,8,551,452,1724,341,1737,1881,1036,333,1954,1436,1344,1186,1560,1989,1499,316,1748,473,1521,1514,656,1664,925,513,739,1969,225,1332,1898,625,127,1705,1952,1262,1373,622,1259,307,931,1828,1515,1262,1861,1376,1063,823,1510,1637,283,1879,1845,1003,147,761,1896,570,546,1068,96,778,1201,1278,1895,757,1905,1482,1448,465,1549,796,1792,1144,1485,450,1472,853,44,1566,986,1056,1060,903,1818,601,122,1307,184,1939,1305,1099,925,449,1496,586,276,1214,853,895,1603,1040,958,874,721,1124,487,459,1720,1498,1007,1576,921,1528,164,1134,1930,449,1314,1956,654,59,1635,1642,1578,1485,816,1485,419,160,23,1868,1727,1191,1231,1175,140,1342,968,474,251,175,1700,1872,1385,1534,706,1958,966,837,1563,653,1409,919,804,236,1452,939,599,1469,1556,89,1054,1388,1458,829,1775,1629,1712,1725,1277,793,784,1774,1717,1799,1366,685,689,1570,1059,561,823,284,673,722,1075,1150,1537,1973,1951,1223,1308,521,666,400,845,1500,1204,555,1353,690,1152,1192,1328,986,913,1875,1645,1926,1663,778,1365,1795,335,349,1886,637,53,1748,271,146,108,216,1230,1343,839,1016,167,1837,1468,1289,1501,1243,1670,1555,302,1695,346,1844,1983,1796,407,392,691,1155,3,1649,1507,1938,418,1154,608,1373,1819,1811,1486,714,580,1879,733,28,718,1512,1560,1615,1166,300,1743,279,813,1513,644,1442,1046,1317,257,48,1398,1881,1842,1432,1580,428,163,286,417,540,1810,24,1449,478,175,1838,1375,1215,560,1442,1363,1027,1881,1734,823,1127,800,1767,1754,1549,160,112,1309,1935,1651,1772,1421,562,1826,747,447,188,650,1187,1289,1952,1439,13,1610,1702,400,1500,277,1405,946,1895,1047,588,1796,442,433,736,521,1260,1416,647,1353,1937,1438,1012,129,1530,1040,1101,872,318];

% Select one image number 5
is = is(5); 
iis = iis(5);

tic

for j = 1 : n_runs

    for i = 1 : length(is)

            try
                %[G, ginfo] = createRandomSingleSectionsGrids(i, datapath, stepThin, delta, downsize, 'shiftstep', shiftstep); % for 300 models
                [G, ginfo] = createRandomSectionsGrids1(is(i), iis(i), datapath, stepThin, delta, downsize); % for 16000 models
            catch
                disp(['Error in grid generation, i: ', num2str(i)]);
                continue
            end   


            fraccells  = ginfo.fraccells; 
            demcells   = ginfo.demcells;
            rhsbody    = ginfo.rhsbody;
            lhsbody    = ginfo.lhsbody;


            prop = intracellProp(G, fraccells);   
            neiintracells  = prop.neiintracells;  


            fnodes = findCellNodes(G, fraccells); 
            assert(strcmp(G.type{1}, 'tensorGrid'), 'WARNING: perm calculation is for MRST grids, see fnodes');
            fnodes = sort(fnodes, 2, 'ascend');   % fnodes must always be sorted: [LHS body,  RHS body] or [LOWER, UPPER]
            [B, I] = sort(fnodes(:, 1));                  % fnodes also must be sorted ascending of the first comumn for lenA calculation    
            fnodes = [B, fnodes(I, 2)];  


            G = moveBodiesCloser(G, gapr, rhsbody, lhsbody, fnodes); 
            clear prop grid_type B I 

            %-------------------------------------------------------------------------
            % STOKES permeability


            Gfrac = extractSubgrid(G, fraccells);
            matrixvol = sum(G.cells.volumes(lhsbody)) + sum(G.cells.volumes(rhsbody));
            [perm(i), permf(i), finfo] = permStokes(Gfrac, 'matrixvol', matrixvol, 'getFlowInfo', true); % in mD
            vel     = finfo.vel; 
            Gstokes = finfo.G;    
            %fprintf('i: %d\n', i);
            %fprintf('permf:  %d\n',  permf(i))


    end
    
end    

toc